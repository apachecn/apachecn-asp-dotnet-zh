# *ç¬¬åäº”ç« *:åœ¨ Vue.js ä¸­ç”¨ Vue.js å‘é€ POSTã€DELETE å’Œ PUT HTTP è¯·æ±‚

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†çŠ¶æ€ç®¡ç†ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ Vue.js åº”ç”¨ä¸­è®¾ç½®äº† Vuexã€‚ ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä½¿ç”¨ Vuex çš„ CRUD æ“ä½œè¿˜æ²¡æœ‰å®Œæˆã€‚ åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ HTTP è¯·æ±‚å’Œ Vuex å‚ä¸çš„ CRUD æ“ä½œçš„å…¶ä½™éƒ¨åˆ†ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ç« ä¸­æ¶µç›–ä»¥ä¸‹ä¸»é¢˜:

*   ä½¿ç”¨ Axios å’Œ Vuex åˆ é™¤æ—…æ¸¸åˆ—è¡¨
*   ä½¿ç”¨ Axios å’Œ Vuex æ·»åŠ æ—…æ¸¸åˆ—è¡¨
*   åœ¨ Vuex ä¸­ä½¿ç”¨éå¼‚æ­¥æ“ä½œ
*   ä½¿ç”¨ Axios å’Œ Vuex ç§»é™¤æ—…è¡Œå›¢
*   ä½¿ç”¨ Axios å’Œ Vuex æ·»åŠ æ—…è¡Œå›¢
*   ä½¿ç”¨ Axios å’Œ Vuex æ›´æ–°æ—…æ¸¸å¥—é¤

# æŠ€æœ¯è¦æ±‚

ä½ éœ€è¦ Visual Studio Code æ¥å®Œæˆæœ¬ç« ã€‚

æœ¬ç« å·²å®Œæˆçš„çŸ¥è¯†åº“å¯ä»¥åœ¨[https://github.com/PacktPublishing/ASP.NET-Core-and-Vue.js/tree/master/Chapter15/](https://github.com/PacktPublishing/ASP.NET-Core-and-Vue.js/tree/master/Chapter15/)æ‰¾åˆ°ã€‚

# ä½¿ç”¨ Axios å’Œ Vuex ç§»é™¤æ—…æ¸¸åˆ—è¡¨

å¦‚æœä½ ä»ç„¶æ¸´æœ›ç”¨ Axios å’Œ Vuex å†™ä¸€äº›ä¸œè¥¿ï¼Œè¿™ä¸ªéå¸¸é€‚åˆä½ ã€‚ æˆ‘ä»¬å°†å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æˆ‘ä»¬çš„ASP.NET Core Web API æ£€ç´¢`TourList`é›†åˆï¼Œä½¿ç”¨ Vuetify ç»„ä»¶åœ¨ UI ä¸Šå‘ˆç°é›†åˆï¼Œç„¶åèƒ½å¤Ÿåˆ é™¤ä»»ä½•`TourList`å¯¹è±¡ã€‚ ä½†åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹ ASP.NET Core Web API é¡¹ç›®ã€‚

ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`namespace Travel.Application.Dtos.Tour`ä¸­çš„`TourPackageDto.cs`æ–‡ä»¶:

```
public float Price { get; set; }
public string MapLocation { get; set; }
```

æˆ‘ä»¬æ­£åœ¨æ·»åŠ `Price`å’Œ`MapLocation`å±æ€§ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°åç«¯æœåŠ¡ã€‚ è½¬åˆ°æœ‰`namespace of Travel.WebApi.Controllers.v1`çš„`TourPackagesController.cs`æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ä»£ç æ·»åŠ ä¸€ä¸ªæ–°çš„å¼‚æ­¥æ“ä½œæ–¹æ³•:

```
[HttpPut("{id}")]
public async Task<ActionResult> Update(int id, UpdateTourPackageCommand command)
{
  if (id != command.Id)
      return BadRequest();
  await Mediator.Send(command);
  return NoContent();
}
```

å‰é¢çš„ c#ä»£ç æ˜¯ä¸€ä¸ªé¢å¤–çš„æ§åˆ¶å™¨ï¼Œç”¨äº Web API åœ¨åº”ç”¨ä¸­ç¼–è¾‘ç°æœ‰çš„æ—…æ¸¸åŒ…ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„ ASP.NET æ ¸å¿ƒ Web API é¡¹ç›®ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºæˆ‘ä»¬çš„ Vue.js åº”ç”¨ï¼Œå¹¶å®Œæˆæˆ‘ä»¬çš„ Travel Tour Web åº”ç”¨çš„åŠŸèƒ½ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª`delete`åŠŸèƒ½æ˜¯ä»…æ¬¡äº`fetch`åŠŸèƒ½çš„ç¬¬äºŒå®¹æ˜“å®ç°çš„äº‹æƒ…ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´æ–°`AdminDashboard`ç›®å½•çš„`DefaultContent.vue`æ–‡ä»¶ã€‚ é¦–å…ˆæ˜¯å°†`mapActions`å¯¼å…¥`DefaultContent`ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
import { mapActions } from "vuex";
```

æˆ‘ä»¬å°†ä¹Ÿä¼šåœ¨`DefaultContent`ç»„ä»¶ä¸­ä½¿ç”¨`mapActions`ï¼Œå°±åƒå‰ä¸€ç« çš„`WeatherForecast`ç»„ä»¶ä¸­ä½¿ç”¨çš„ä¸€æ ·ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»º`methods`å¯¹è±¡ï¼Œå¹¶åƒè¿™æ ·ä½¿ç”¨`mapActions`:

```
  methods: {
    ...mapActions("tourModule", ["getTourListsAction"]),
  },
```

å‰é¢çš„ä»£ç ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª`getTourListsAction`æ–¹æ³•ã€‚

ç°åœ¨åˆ›å»º`mounted`æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨`getTourListsAction`:

```
  mounted() { this.getTourListsAction(); },
```

å‰é¢çš„ä»£ç å°†åœ¨å‘ˆç° DOM æ—¶è§¦å‘`getTourListsAction`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæœ¬åœ°åŒ–çš„æ ·å¼éƒ¨åˆ†ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªé»˜è®¤å†…å®¹ç±»:

```
<style scoped>
.default-content {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: flex-start;
}
</style>
```

å‰é¢çš„ CSS å°†ä¸ºæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ®µä»£ç ä¸­ç¼–å†™çš„`div`æ ‡è®°æä¾›æ ·å¼ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ›´æ–°`template`è¯­æ³•éƒ¨åˆ†:

```
<template>
  <div>
    <div class="text-h2 my-4">Welcome to Admin 
    Dashboard</div>
    <div class="default-content"></div>
  </div>
</template>
```

å‰é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„æ¬¢è¿æ¶ˆæ¯ï¼Œè¡¨ç¤º`Welcome to Admin Dashboard`ã€‚ åœ¨åˆ›å»º`card`ç»„ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°†å›åˆ°è¿™ä¸ªç»„ä»¶ã€‚

è½¬åˆ°`components`æ–‡ä»¶å¤¹å¹¶åˆ›å»ºä¸€ä¸ª`Vue.js`ç»„ä»¶æ–‡ä»¶`TourListsCard.vue`ã€‚

åœ¨æ–°åˆ›å»ºçš„ Vue ç»„ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è„šæœ¬:

```
<script>
import { mapActions, mapGetters } from "vuex";
export default {
  name: "TourListsCard",
  computed: {
    ...mapGetters("tourModule", {
      lists: "lists", loading: "loading",
    }),
  },
};
</script>
```

æˆ‘ä»¬ä» Vuex å¼•è¿›äº†`mapActions`å’Œ`mapGetters`ã€‚ ç„¶åæˆ‘ä»¬ä½¿ç”¨`mapGetters`å°†å…¨å±€çŠ¶æ€çš„åˆ—è¡¨å’ŒåŠ è½½å¸¦åˆ°å±€éƒ¨çŠ¶æ€çš„åˆ—è¡¨å’ŒåŠ è½½ã€‚ è¯·æ³¨æ„ï¼Œå…¨å±€çŠ¶æ€å’ŒåŠ è½½çŠ¶æ€çš„ä»»ä½•å˜åŒ–ä¹Ÿå°†åæ˜ åœ¨æœ¬åœ°åŒ–åˆ—è¡¨å’ŒåŠ è½½çŠ¶æ€ä¸­ã€‚

è®©æˆ‘ä»¬å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°æ–°åˆ›å»ºçš„`TourListsCard`Vueç»„ä»¶:

```
<template>
  <v-skeleton-loader
    v-if="loading" width="300" max-width="450" 
    height="100%" type="card" ></v-skeleton-loader>
  <v-card v-else width="300" max-width="450" height="100%">
    <v-toolbar color="light-blue" dark>
      <v-toolbar-title>Tour Lists</v-toolbar-title>
      <v-spacer></v-spacer>
    </v-toolbar>
    <v-list-item-group color="primary">
      <v-list-item v-for="tourList in lists" 
      :key="tourList.id">
        <v-list-item-content>
          <v-list-item-title v-text="tourList.city"></v-
           list-item-title>
          <v-list-item-subtitle v-text="tourList.about">
          </v-list-item-subtitle>
        </v-list-item-content>
        <v-list-item-action>
          <div class="mr-2">
            {{ tourList.tourPackages && 
            tourList.tourPackages.length }}
          </div>
          <v-icon> mdi-delete-outline </v-icon>
        </v-list-item-action>
      </v-list-item>
    </v-list-item-group>
  </v-card>
</template>
```

å‰é¢çš„è¯­æ³•`template`å‘ˆç°ä¸€ä¸ªè£…å…¥å™¨å’Œå¸¦æœ‰`tourLists`åŒ…çš„å¡ã€‚ æˆ‘ä»¬ä½¿ç”¨`v-for`æŒ‡ä»¤ä»åˆ—è¡¨ä¸­æå–å¯¹è±¡ï¼Œç„¶åé€ä¸ªæ¸²æŸ“å®ƒä»¬ã€‚ æ¯ä¸ª`tourList`å¯¹è±¡å°†æ˜¾ç¤ºä¸¤ä¸ªå±æ€§çš„ä¸¤ä¸ªå€¼â€”â€”UI ä¸­çš„`city`å±æ€§çš„å€¼å’Œ`about`å±æ€§çš„å€¼ã€‚

ç°åœ¨è®©æˆ‘ä»¬å›åˆ°`DefaultContent.vue`å¹¶æ›´æ–°å®ƒã€‚

ä»`components`ç›®å½•å¯¼å…¥`TourListsCard`ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
import TourListsCard from "@/components/TourListsCard";
```

æ‚¨å¯ä»¥ä½¿ç”¨`@/`è½»æ¾å¯¼èˆªåˆ°`src`ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ã€‚ ç°åœ¨ä½¿ç”¨ä¸‹é¢çš„å¯¼å…¥ç»„ä»¶:

```
  components: { TourListsCard, Ã¥},
```

æˆ‘ä»¬å·²ç»å°†`TourListsCard`ç»„åˆ†æ³¨å†Œåˆ°`DefaultContent`ç»„åˆ†ä¸­ã€‚

ç°åœ¨ï¼Œåœ¨å¸¦æœ‰é»˜è®¤å†…å®¹ç±»çš„`div`å…ƒç´ ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç :

```
      <div style="margin-right: 4rem; margin-bottom: 4rem">
        <TourListsCard />
      </div>
```

æˆ‘ä»¬åœ¨å‰é¢çš„ä»£ç ä¸­å‘ˆç°äº†`TourListsCard`ã€‚ é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚

åœ¨`Travel.WebApi`é¡¹ç›®ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:

```
dotnet run
```

å‰é¢çš„å‘½ä»¤å°†è¿è¡Œæ•´ä¸ªåº”ç”¨ï¼Œè¿™æ„å‘³ç€åŒæ—¶è¿è¡Œåç«¯å’Œå‰ç«¯ã€‚

ä¸‹é¢çš„*å›¾ 15.1*æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„ä»ªè¡¨æ¿ï¼Œå…¶ä¸­å¸¦æœ‰æ¬¢è¿æ¶ˆæ¯:

![Figure 15.1 â€“ A welcome message on the Admin Dashboard component ](image/Figure_15.1_B15970.jpg)

å›¾ 15.1 - Admin Dashboard ç»„ä»¶ä¸Šçš„æ¬¢è¿æ¶ˆæ¯

ç°åœ¨æˆ‘ä»¬å‡†å¤‡åœ¨ Axios ä¸­ç¼–å†™`delete`åŠŸèƒ½å¹¶å°†å…¶å­˜å‚¨ã€‚ æ‚¨å°†å‘ç°åœ¨çŠ¶æ€ç®¡ç†ä¸­ç¼–å†™é¢å¤–çš„æ“ä½œæ˜¯å¤šä¹ˆå®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ä¸Šä¸€ç« ä¸­è®¾ç½®äº†å­˜å‚¨ã€‚ ç°åœ¨,è®©æˆ‘ä»¬ç»§ç»­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`store/tour/`ç›®å½•çš„`services.js`:

```
export async function deleteTourListAxios(id) {
  return await api.delete("TourLists/" + id);
}
```

å‰é¢çš„ä»£ç æ˜¯ä¸€ä¸ªåˆ é™¤`tourList`å¯¹è±¡çš„æœåŠ¡:

æˆ‘ä»¬ä¹Ÿæ›´æ–°ä¸€ä¸‹`store/tour/`çš„`types.js`:

```
export const REMOVE_TOUR_LIST = "REMOVE_TOUR_LIST";
```

æˆ‘ä»¬æ­£åœ¨å‘`types.js`æ–‡ä»¶æ·»åŠ ä¸€ä¸ªæ–°çš„æ“ä½œç±»å‹ã€‚ åŠ¨ä½œç±»å‹æ˜¯ç”¨äºåˆ é™¤æ—…è¡Œåˆ—è¡¨ï¼Œå› æ­¤åœ¨è›‡å½¢å¤–å£³ä¸­å‘½åä¸º`REMOVE_TOUR_LIST`ã€‚

è®©æˆ‘ä»¬ä¹Ÿæ›´æ–°`store/tour/`ç›®å½•çš„`actions.js`æ–‡ä»¶:

```
import { getTourListsAxios, deleteTourListAxios } from "@/store/tour/services";
```

åœ¨æ·»åŠ `remove`åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥`deleteTourListAxios`æœåŠ¡ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†`removeTourListAction`å‡½æ•°å†™æˆè¿™æ ·:

```
// asynchronous action using Axios
export async function removeTourListAction({ commit }, payload) {
  commit(types.LOADING_TOUR, true);
  try {
    await deleteTourListAxios(payload);
    commit(types.REMOVE_TOUR_LIST, payload);
  } catch (e) {
    alert(e);
    console.log(e);
  }
  commit(types.LOADING_TOUR, false);
}
```

å‰é¢çš„å‡½æ•°æ˜¯`removeTourListAction`ï¼Œå®ƒæ¥å—ä¸€ä¸ªæœ‰æ•ˆè´Ÿè½½ã€‚ è§¦å‘`removeTourListAction`æ—¶éœ€è¦ä½¿ç”¨çš„å‚æ•°æŠ€æœ¯ä¸Šåªæœ‰ä¸€ä¸ªï¼Œå³æœ‰æ•ˆè´Ÿè½½ï¼Œè€Œæœ‰æ•ˆè´Ÿè½½æ˜¯æˆ‘ä»¬å°†è¦åˆ é™¤çš„`tourList`çš„ IDã€‚

ç°åœ¨ï¼Œæ‚¨å°†æ³¨æ„åˆ°åœ¨`removeTourListAction`ä¸­ï¼Œå®ƒé€šè¿‡æäº¤`types.LOADING_TOUR`å¹¶åœ¨ä½¿ç”¨`deleteTourListAxios`æœåŠ¡å‘é€åˆ é™¤è¯·æ±‚ä¹‹å‰ä¼ é€’`true`æ¥å¯ç”¨åŠ è½½ã€‚ è¯¥å‡½æ•°è¿˜åˆ›å»ºä¸€ä¸ªæäº¤ï¼Œåˆ é™¤`tourList`å¹¶åœ¨ ASP ä¸­åˆ é™¤å®ƒã€‚ å‡€çš„æ ¸å¿ƒã€‚

`removeTourListAction`ä¹Ÿå†æ¬¡ä½¿ç”¨`false`çš„å¸ƒå°”å€¼æäº¤`types.LOADING_TOUR`ï¼Œè¿™å°†ç¦ç”¨`loader`ç»„ä»¶ï¼Œæˆ–è€…`spinner`ç»„ä»¶ï¼Œä»æ—‹è½¬ã€‚

ç°åœ¨ï¼Œæ›´æ–°`store/tour/`çš„`mutations.js`:

```
  [types.REMOVE_TOUR_LIST](state, id) {
    state.lists = state.lists.filter((tl) => tl.id !== id);
    state.packagesOfSelectedCity = [];
  },
```

`types.REMOVE_TOUR_LIST`æ“ä½œç±»å‹æœ‰ä¸€ä¸ªæŒ‡ä»¤ï¼Œé€šè¿‡åªä»å‚æ•°ä¸­è·å–å…·æœ‰`id`ä¸”ä¸ç­‰äº`id`çš„å¯¹è±¡æ¥è¿‡æ»¤æ‰æ‰€æœ‰å¯¹è±¡ã€‚ ç„¶åï¼Œæ“ä½œç±»å‹è¿˜å°†`packagesOfSelectedCity`å…¨å±€çŠ¶æ€è®¾ç½®ä¸ºç©ºæ•°ç»„ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€ä¸ªå¸¦æœ‰`mapActions`çš„`methods`å¯¹è±¡å’Œä¸€ä¸ªé¢å¤–çš„`removeTourList`å‡½æ•°æ¥æ›´æ–°`TourListsCard.vue`ç»„ä»¶ï¼Œå®ƒé‡‡ç”¨`listId`å¦‚ä¸‹æ‰€ç¤º:

```
  methods: {
    ...mapActions("tourModule", ["removeTourListAction"]),
    removeTourList(listId) {
      const confirmed = confirm(
        "You sure you want to delete this tour list? This 
         will also delete the packages permanently"
      );
      if (!confirmed) return;
      this.removeTourListAction(listId);
    },
  },
```

æ‚¨å°†æ³¨æ„åˆ°åœ¨åˆ é™¤æˆ–åˆ é™¤æ—…æ¸¸åˆ—è¡¨ä¹‹å‰æœ‰ä¸€ä¸ªç¡®è®¤æç¤ºã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒè¿™æ ·æ›´æ–°`TourListsCard`Vue ç»„ä»¶çš„`template`è¯­æ³•éƒ¨åˆ†ä¸­çš„`v-icon`ç»„ä»¶:

```
<v-icon @click="removeTourList(tourList.id)">
  mdi-delete-outline
</v-icon>
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†`removeTourList`å‡½æ•°ç»‘å®šåˆ°`@click`æŒ‡ä»¤ï¼Œå°†æä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚

å¦‚æœ ESLint é”™è¯¯é˜»æ­¢ Vue.js åº”ç”¨åˆ·æ–°ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚ ç°åœ¨é‡æ–°è¿è¡Œ ASP.NET Core Web API é¡¹ç›®ï¼Œè¿è¡Œ`dotnet run`å‘½ä»¤ã€‚

è¯¥å‘½ä»¤å°†å†æ¬¡å¯åŠ¨æ•´ä¸ªåº”ç”¨ã€‚ ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œå‰å¾€æˆ‘ä»¬çš„åº”ç”¨çš„**ç®¡ç†ä»ªè¡¨æ¿**é¡µé¢:

![Figure 15.2 â€“ Card component with the Tour Lists collection ](image/Figure_15.2_B15970.jpg)

å›¾ 15.2 -å¸¦æœ‰æ¼«æ¸¸åˆ—è¡¨çš„å¡ç‰‡ç»„ä»¶

å›¾ 15.2 ä¹‹å‰çš„æ˜¾ç¤ºäº†é‡æ–°è¿è¡Œåº”ç”¨åçš„å¡ç‰‡ UI ç»„ä»¶ã€‚ æ‚¨ç°åœ¨å¯ä»¥çœ‹åˆ°å¸¦æœ‰`delete`åŠŸèƒ½çš„`tourList`çš„é›†åˆã€‚ åƒåœ¾æ¡¶å›¾æ ‡ä¸Šæ–¹çš„æ•°å­—è¡¨ç¤ºå¯åœ¨æ—…æ¸¸åˆ—è¡¨ä¸­ä½¿ç”¨çš„è½¯ä»¶åŒ…ã€‚ **0**è¡¨ç¤ºå°šæœªæ·»åŠ åŒ…ã€‚

å°è¯•åˆ é™¤**Manila**å¹¶ä»”ç»†æŸ¥çœ‹ UIã€‚ ç”¨æˆ·ç•Œé¢åº”è¯¥åœ¨åˆ é™¤æ—…æ¸¸åˆ—è¡¨åæ›´æ–°ã€‚

æˆ‘ä»¬å·²ç»æˆåŠŸåœ°åœ¨åº”ç”¨ä¸­æ·»åŠ äº†åˆ é™¤æˆ–åˆ é™¤æ—…è¡Œåˆ—è¡¨çš„åŠŸèƒ½ã€‚ åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè¡¨å•ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ—…æ¸¸åˆ—è¡¨ã€‚

# ä½¿ç”¨ Axios å’Œ Vuex æ·»åŠ æ—…æ¸¸åˆ—è¡¨

åœ¨ CRUD ä¸­ï¼Œ`Create`æˆ–`Add`åŠŸèƒ½æ˜¯ç¬¬ä¸‰ä¸ªæœ€å®¹æ˜“å®ç°çš„åŠŸèƒ½ã€‚ è·å–å’Œåˆ é™¤åŠŸèƒ½å¾ˆå®¹æ˜“ï¼Œå› ä¸ºä¸éœ€è¦`form`ç»„ä»¶å’Œä¸€äº›è¾“å…¥å­—æ®µã€‚ ä¸ºäº†åˆ›å»ºæ·»åŠ æˆ–ç”Ÿæˆæ–°æ•°æ®çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¿…é¡»æ„å»ºä¸€ä¸ªè¡¨å•ã€‚

åœ¨ä¸º UI æ„å»ºè¡¨å•ä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆåœ¨ Axios å’Œ Vuex ä¸­å¼€å‘åˆ›å»ºæ—…æ¸¸åˆ—è¡¨çš„åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä»¥ä¸‹ä»£ç æ¥æ›´æ–°`store/tour`ä¸­çš„`services.js`:

```
export async function postTourListAxios(tourList) {
  return await api.post("TourLists", tourList);
}
```

å‰é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå‘åç«¯å‘é€*POST*è¯·æ±‚ä»¥åˆ›å»º`tourList`æ•°æ®æ¡ç›®çš„æœåŠ¡ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ–°`store/tour`ç›®å½•çš„`types.js`ã€‚

```
export const ADD_TOUR_LIST = "ADD_TOUR_LIST";
```

æˆ‘ä»¬åœ¨å‰é¢çš„ä»£ç ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„æ“ä½œç±»å‹ã€‚ æœ€æ–°çš„åŠ¨ä½œç±»å‹æ˜¯ç”¨äºæ·»åŠ æ–°çš„`tourList`ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ›´æ–°`store/tour`ç›®å½•çš„`actions.js`:

```
import { getTourListsAxios, deleteTourListAxios,
  postTourListAxios,} from "@/store/tour/services";
```

åœ¨æ·»åŠ æ–°æ“ä½œä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¯¼å…¥`postTourListAxios`æœåŠ¡ã€‚

åœ¨å¯¼å…¥æ–°åˆ›å»ºçš„æœåŠ¡ä¹‹åï¼Œè®©æˆ‘ä»¬å‘`actions.js`æ·»åŠ ä¸€ä¸ªæ–°æ“ä½œ:

```
// asynchronous action using Axios
export async function addTourListAction({ commit }, payload) {
  commit(types.LOADING_TOUR, true);
  try {
    const { data } = await postTourListAxios(payload);
    payload.id = data; // storing the id from the response 
    int of ASP.NET Core, which will be used in the UI.
    payload.tourPackages = []; // initialize the 
    tourPackages of the newly created tourList
    commit(types.ADD_TOUR_LIST, payload);
  } catch (e) {
    alert(e);
    console.log(e);
  }
  commit(types.LOADING_TOUR, false);
}
```

å‰é¢çš„ä»£ç æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œå‡½æ•°ã€‚ è¿™æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Axios å‘é€ HTTP è¯·æ±‚çš„æ“ä½œã€‚ è¯¥æ“ä½œä»¥`tourList`ä½œä¸ºè´Ÿè½½ã€‚ å®ƒæŠŠå®ƒå‘é€ç»™ ASP.NET Core ä½¿ç”¨æœåŠ¡ã€‚

ä½œä¸ºå“åº”ï¼ŒæœåŠ¡ä»åç«¯è¿”å›æ–°åˆ›å»ºçš„æ—…è¡Œåˆ—è¡¨çš„`id`ã€‚ ç„¶åæˆ‘ä»¬å°†å“åº”å­˜å‚¨åœ¨`payload.id`ä¸­ï¼Œä»¥ä¾¿åœ¨æ›´æ–° UI æ—¶åœ¨çªå˜ä¸­ä½¿ç”¨å®ƒã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä»¥ä¸‹ä»£ç æ¥æ›´æ–°`store/tour`ä¸­çš„`mutations.js`:

```
  [types.ADD_TOUR_LIST](state, tourList) {
    state.lists.unshift(tourList);
  },
```

å‰é¢çš„çªå˜å°†æ–°åˆ›å»ºçš„`tourList`æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´ã€‚ unshift å¸®åŠ©æˆ‘ä»¬å¾ˆå®¹æ˜“åœ°çœ‹åˆ°åœ¨`card`ç»„ä»¶ä¸­æ–°æ·»åŠ çš„`tourList`ã€‚

ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª`helper`å‡½æ•°ï¼Œå¹¶å°†å…¶æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹ä¸­ã€‚

è®©æˆ‘ä»¬åœ¨`src`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶å‘½åä¸º`helpers`ã€‚ ç„¶åï¼Œåœ¨`helpers`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`collections.js`çš„ JavaScript æ–‡ä»¶ã€‚

`collection.js`æ–‡ä»¶æœ‰ä¸€ä¸ª`getCountryList`å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå›½å®¶æ•°ç»„ï¼Œæˆ‘ä»¬å°†åœ¨è¡¨å•çš„æœç´¢è¾“å…¥ä¸­éœ€è¦è¿™ä¸ªæ•°ç»„ã€‚ æˆ‘ä»¬å°†å¾ˆå¿«åˆ›å»ºè¡¨å•å¹¶ç»‘å®š`getCountryList`è¾…åŠ©å‡½æ•°ã€‚

å› æ­¤ï¼Œä» GitHub åº“ä¸­è·å–åä¸º`getCountryList`çš„å¸®åŠ©å‡½æ•°:[https://github.com/PacktPublishing/ASP.NET-Core-and-Vue.js/tree/master/Chapter15](https://github.com/PacktPublishing/ASP.NET-Core-and-Vue.js/tree/master/Chapter15)ã€‚

ç°åœ¨ä¸ºè¡¨æ ¼ã€‚ åœ¨`components`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`AddTourListForm.vue`çš„ Vueç»„ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹è„šæœ¬:

```
<script>
import { getCountryList } from "@/helpers/collections";
import { mapActions } from "vuex";
export default {
  name: "AddTourListForm",
  data: () => ({
    bodyRequest: { city: "", country: "", about: "", },
    dialog: false,
    countryList: getCountryList(),
  }),
  methods: {
    ...mapActions("tourModule", ["addTourListAction"]),
  },
};
</script>
```

æˆ‘ä»¬ä» Vuex å¯¼å…¥äº†`getCountryList`è¾…åŠ©å‡½æ•°å’Œ`mapActions`è¾…åŠ©å‡½æ•°ã€‚ æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå±€éƒ¨çŠ¶æ€`bodyRequest`å¯¹è±¡ã€ä¸€ä¸ªå¸ƒå°”å¯¹è¯æ¡†å’Œ`countryList`ï¼Œåè€…æ˜¯`getCountryList`è¿”å›çš„æ•°ç»„ã€‚

ç°åœ¨ï¼Œä¸‹é¢çš„ä»£ç æ˜¯é’ˆå¯¹çš„`template`è¯­æ³•çš„`AddTourListView`ç»„ä»¶:

```
<template>
  <v-row justify="center">
    <v-dialog v-model="dialog" persistent max-
     width="600px">
      <template v-slot:activator="{ on, attrs }">
        <v-btn
          style="margin-top: 1rem" rounded color="light-
          blue"
          dark v-bind="attrs" v-on="on">
          <v-icon left>mdi-plus</v-icon>
          add new tour list
        </v-btn>
      </template>
      <!-- INSERT <v-card> BELOW -->
    </v-dialog>
  </v-row>
</template>
```

`v-btn`æ˜¯æ¥è‡ª Vuetify çš„ä¸€ä¸ªæŒ‰é’®ç»„ä»¶ï¼Œå®ƒå°†ä½¿ç”¨`v-slot`æŒ‡ä»¤æ¿€æ´»å™¨è§¦å‘æ¨¡æ¿ï¼Œä»¥ä¾¿ç¨åæ˜¾ç¤ºå¯¹è¯æ¡†çª—ä½“ã€‚ `v-slot`æŒ‡ä»¤ç”¨äºåŒ…è£…å¦ä¸€ä¸ªç»„ä»¶ï¼Œä½¿å…¶å¯é‡ç”¨ã€‚

ä½ ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªæ³¨é‡Šè¯´`insert v-card`ã€‚ æˆ‘ä»¬å°†æ·»åŠ ä»¥ä¸‹`template`è¯­æ³•ã€‚ å› æ­¤ï¼Œç”¨æ›´æ–°`AddTourListForm.vue`å¦‚ä¸‹ä»£ç :

```
<v-card>
        <form @submit.prevent="
            addTourListAction(bodyRequest);
            bodyRequest = {};">
          <v-card-title>
            <span class="headline">Create New Tour 
             List</span>
          </v-card-title>
          <v-card-text>
            <v-container>
              <v-row>
                <v-col cols="12" sm="6">
                  <v-text-field required label="City"
                    v-model="bodyRequest.city" 
                  ></v-text-field>
                </v-col>
                <v-col cols="12" sm="6">
                  <v-autocomplete required
                    :items="countryList" label="Country"
                    v-model="bodyRequest.country" 
                  ></v-autocomplete>
                </v-col>
            <!-- Removed for brevity -->
            <!-- Please see the full code in GitHub -->
            <v-btn color="blue darken-1" text
              @click="dialog = false" type="submit" >
              Save
            </v-btn>
          </v-card-actions>
        </form>
      </v-card>
```

å‰é¢çš„ä»£ç æ˜¯è®©æˆ‘ä»¬åˆ›å»ºæ–°çš„`tourList`çš„è¡¨å•ã€‚ è¡¨å•æœ‰ä¸€ä¸ªç”¨äº`city`çš„æ–‡æœ¬å­—æ®µï¼Œä¸€ä¸ªç”¨äº`country`çš„å¸¦æœ‰è‡ªåŠ¨è¡¥å…¨çš„å­—æ®µï¼Œä»¥åŠä¸€ä¸ªç”¨äº`about`çš„æ–‡æœ¬åŒºåŸŸã€‚ æˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°`v-btn`ç»„ä»¶å…·æœ‰`submit`ç±»å‹ã€‚ ç±»å‹è§¦å‘è¿è¡Œ`addTourListAction`çš„çª—ä½“çš„`@submit`ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ›´æ–°`form`ç»„ä»¶æ¥å°†å…¶åŒ…å«åœ¨`DefaultContent.vue`æ–‡ä»¶ä¸­:

```
import AddTourListForm from "@/components/AddTourListForm";
```

æˆ‘ä»¬ä»ç»„ä»¶ä¸­å¼•å…¥äº†`AddTourListForm`ç»„ä»¶ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†`AddTourListForm`æ³¨å†Œåˆ°ç»„ä»¶å¯¹è±¡ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
  components: { TourListsCard, AddTourListForm, },
```

ç°åœ¨å¯ä»¥åœ¨`Default`ç»„ä»¶çš„æ¨¡æ¿è¯­æ³•åŒºåŸŸä¸­ä½¿ç”¨`AddTourListForm`äº†ã€‚

åœ¨`TourListsCard`ç»„ä»¶ä¸‹é¢æ·»åŠ `AddTourListForm`ç»„ä»¶:

```
        <TourListsCard />
        <AddTourListForm />
```

é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ã€‚ è¿è¡Œ`dotnet run`å‘½ä»¤è¿è¡Œæ•´ä¸ªåº”ç”¨ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œè¿›å…¥åº”ç”¨çš„ç®¡ç†é¢æ¿ï¼Œåœ¨é‚£é‡Œä½ ä¼šçœ‹åˆ°ä»¥ä¸‹æˆªå›¾:

![Figure 15.3 â€“ ADD NEW TOUR LIST button ](image/Figure_15.3_B15970.png)

å›¾ 15.3 -æ·»åŠ æ–°çš„æ—…è¡Œå›¢åˆ—è¡¨æŒ‰é’®

å›¾ 15.3 å‰çš„æ˜¾ç¤ºäº†æ¥è‡ª Vuetify çš„**ADD NEW TOUR LIST**æŒ‰é’®ã€‚ ç‚¹å‡»æ‰“å¼€è¡¨å•:

![Figure 15.4 â€“ Adding a tour list Form ](image/Figure_15.4_B15970.jpg)

å›¾ 15.4 -æ·»åŠ æ—…æ¸¸åˆ—è¡¨è¡¨å•

*å›¾ 15.4*æ˜¾ç¤ºåˆ›å»ºæˆ–æ·»åŠ æ–°çš„æ—…æ¸¸åˆ—è¡¨çš„è¡¨å•ã€‚ å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹åˆ›å»ºå’Œå‘é€æ—…æ¸¸åˆ—è¡¨çš„ç»“æœã€‚

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºç‰¹å®šçš„æ—…æ¸¸åˆ—è¡¨è·å–æ—…æ¸¸å¥—é¤ã€‚

# åœ¨ Vuex ä¸­ä½¿ç”¨éå¼‚æ­¥æ“ä½œ

æˆ‘ä»¬å¯ä»¥åœ¨ UI ä¸­çœ‹åˆ°æ—…æ¸¸åˆ—è¡¨çš„é›†åˆï¼Œä½†ä¸èƒ½çœ‹åˆ°ä»–ä»¬çš„æ—…æ¸¸å¥—é¤ã€‚ æœ¬èŠ‚å°†ä½¿ç”¨ Vuex è€Œä¸ä½¿ç”¨ Axios ä»æ—…æ¸¸åˆ—è¡¨ä¸­æå–æ—…æ¸¸åŒ…ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘é€ HTTP è¯·æ±‚ã€‚ æ²¡æœ‰ HTTP è¯·æ±‚æ„å‘³ç€æˆ‘ä»¬å°†ä½¿ç”¨éå¼‚æ­¥æ“ä½œã€‚ æ‚¨å°†å­¦ä¹ å¦‚ä½•æœ‰æ•ˆåœ°ä½¿ç”¨ Vuex å’Œéå¼‚æ­¥æ“ä½œã€‚ è®©æˆ‘ä»¬å¼€å§‹ã€‚

ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`store/tour`æ–‡ä»¶å¤¹ä¸­çš„`types.js`æ–‡ä»¶:

```
export const GET_PACKAGES_OF_SELECTED_CITY = "GET_PACKAGES_OF_SELECTED_CITY";
```

å‰é¢çš„ä»£ç æ˜¯æˆ‘ä»¬åœ¨`types.js`ä¸­æ·»åŠ çš„ä¸€ä¸ªæ–°çš„æ“ä½œç±»å‹ã€‚

ç„¶åï¼Œç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`store/tour`ä¸­çš„`actions.js`:

```
// non-asynchronous action
export function getPackagesOfSelectedCityAction({ commit }, payload) {
  commit(types.GET_PACKAGES_OF_SELECTED_CITY, payload);
}
```

æ‚¨å°†åœ¨å‰é¢çš„æ“ä½œä¸­æ³¨æ„åˆ°æ²¡æœ‰`try`å’Œ`catch`å—ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨è¿™é‡Œä½¿ç”¨ Axiosã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`state.js`:

```
  packagesOfSelectedCity: [],
```

æœ€åï¼Œå¯¹äºæ¥è‡ªç‰¹å®šåŸå¸‚çš„æ—…æ¸¸å¥—é¤ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå·ã€‚

ç°åœ¨ï¼Œæ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`mutations.js`:

```
  [types.GET_PACKAGES_OF_SELECTED_CITY](state, packages) {
    state.packagesOfSelectedCity = packages;
  },
```

æˆ‘ä»¬ç°åœ¨å°†æœ‰æ•ˆè´Ÿè½½ä½œä¸ºåŒ…ä½¿ç”¨ï¼Œç„¶åå°†å®ƒä»¬å­˜å‚¨åœ¨`packagesOfSelectedCity`çŠ¶æ€ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`getters.js`:

```
packagesOfSelectedCity: (state) => state.packagesOfSelectedCity,
```

æˆ‘ä»¬ç¨åä¼šåœ¨ UI ä¸­ä½¿ç”¨å‰é¢çš„ getter å‡½æ•°ã€‚

ç°åœ¨æ˜¯æ—¶å€™æ›´æ–°`TourListsCard`ç»„ä»¶äº†ã€‚ è½¬åˆ°`TourListsCard.vue`æ–‡ä»¶ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›´æ–°ç»„ä»¶:

```
    ...mapActions("tourModule", [
      "removeTourListAction",
      "getPackagesOfSelectedCityAction",
    ]),
```

æˆ‘ä»¬ç°åœ¨å±•ç¤ºçš„æ˜¯æ–°çš„è¡ŒåŠ¨ï¼Œå³`getPackagesOfSelectedAction`ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä»£ç å—å‘`methods`æ·»åŠ ä¸€ä¸ªæ–°å‡½æ•°:

```
  addToPackages(packages, listId) {
    this.getPackagesOfSelectedCityAction(packages);
    this.$emit("handleShowPackages", true, listId);
  },
```

æˆ‘ä»¬ä½¿ç”¨`getPackagesOfSelectedCityAction`å’Œå‘å°„`handleShowPackages`ä½œä¸ºæ”¯æ’‘`TourListsCard`æˆåˆ†ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`TourListsCard`ç»„ä»¶çš„`v-list-item-content`ç»„ä»¶:

```
<v-list-item-content
   @click="addToPackages(tourList.tourPackages, 
   tourList.id)">
```

ç‚¹å‡»äº‹ä»¶å°†è§¦å‘æˆ‘ä»¬åˆšåˆšæ·»åŠ åˆ°`methods`å—ä¸­çš„`addToPackages`å‡½æ•°ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`DefaultContent.vue`ç»„ä»¶æ–‡ä»¶:

```
  methods: {
    ...mapActions("tourModule", ["getTourListsAction"]),
    handleShowPackages(show, listId) {
      this.showPackages = show;
      this.tourListId = listId;
    },
  },
```

æˆ‘ä»¬æ­£åœ¨å°†`handleShowPackages`æ–¹æ³•æ·»åŠ åˆ°`methods`å—ä¸­ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¹Ÿæ·»åŠ ä¸€äº›æœ¬åœ°çŠ¶æ€:

```
  data: () => ({ showPackages: false, tourListId: 0, }),
```

æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸ƒå°”ç±»å‹`showPackages`å’Œä¸€ä¸ªæ•°å­—`tourListId`ã€‚

ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨`DefaultContent.vue`ç»„ä»¶çš„`mounted`ç”Ÿå‘½å‘¨æœŸé’©å­:

```
  mounted() {
    this.getTourListsAction();
    this.showPackages = false;
  },
```

å½“æˆ‘ä»¬è¿›å…¥ç®¡ç†ä»ªè¡¨æ¿é¡µé¢æ—¶ï¼Œè°ƒç”¨`getTourListsAction`å¹¶å°†`showPackages`è®¾ç½®ä¸º`false`ã€‚

ç„¶åï¼Œæ›´æ–°`template`è¯­æ³•ä¸­çš„`<TourListsCard />`:

```
<TourListsCard @handleShowPackages="handleShowPackages" />
```

æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨`TourListsCard`å·²å‘å‡ºçš„`handleShowPackages`é“å…·ï¼Œå¹¶åˆ†é…`DefaultComponent.vue`çš„`handleShowPackages`å‡½æ•°ã€‚

è®©æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç å†æ¬¡æ›´æ–°`template`è¯­æ³•:

```
<div style="margin-right: 4rem; margin-bottom: 4rem">
        <TourListsCard @handleShowPackages
         ="handleShowPackages" />
        <AddTourListForm />
      </div>
      <div v-if="showPackages">
        <h2>Tour Packages Card Here</h2>
        <h3>Add Tour Package Form with tour list Id 
        Here</h3>
      </div>
```

æˆ‘ä»¬æ­£åœ¨å°†`v-if`æŒ‡ä»¤æ·»åŠ åˆ°å‰é¢çš„æ¨¡æ¿åŒºåŸŸä»£ç ä¸­ã€‚

ç°åœ¨è¿è¡Œè¯¥åº”ç”¨å¹¶ç‚¹å‡»ä»»ä½•åŸå¸‚ã€‚

`TourPackagesCard`ç»„ä»¶åº”è¯¥åœ¨è¿è¡Œåº”ç”¨å¹¶ç‚¹å‡»ä»»ä½•åŸå¸‚åå‡ºç°åœ¨å±å¹•å³ä¾§ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä¸€ä¸ªå¿«é€Ÿçš„æ¦‚å¿µè¯æ˜ï¼Œæˆ‘ä»¬å¯ä»¥æ¸²æŸ“`TourPackagesCard`ç»„ä»¶ï¼Œå¦‚ä¸‹é¢çš„æˆªå›¾æ‰€ç¤º:

![Figure 15.5 â€“ Show placeholders ](image/Figure_15.5_B15970.jpg)

å›¾ 15.5 -æ˜¾ç¤ºå ä½ç¬¦

å›¾ 15.5 æ˜¾ç¤ºäº†åœ¨é€‰æ‹©ä»»ä½•**Tour Lists**å¡ç‰‡åŸå¸‚åï¼Œå ä½ç¬¦æ¶ˆæ¯ä¼šå¼¹å‡ºã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥æœ‰æ¡ä»¶åœ°æ˜¾ç¤ºä¸€ä¸ª UIã€‚ è®©æˆ‘ä»¬ä¸ºåŒ…åˆ›å»ºå¡ç‰‡ç»„ä»¶ã€‚

åœ¨`components`æ–‡ä»¶å¤¹ä¸­åˆ›å»º`TourPackagesCard.vue`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹è„šæœ¬:

```
<script>
import { mapActions, mapGetters } from "vuex";
export default {
  name: "TourPackagesCard",
  computed: {
    ...mapGetters("tourModule", {
      packages: "packagesOfSelectedCity",
    }),
  },
};
</script>
```

å‰é¢çš„è„šæœ¬æ­£åœ¨å¯¼å…¥å¹¶ä½¿ç”¨`mapAction`å’Œ`mapGetters`ã€‚

ç°åœ¨è®©æˆ‘ä»¬åŠ å…¥`TourPackagesCard`çš„`template`è¯­æ³•éƒ¨åˆ†ã€‚ æ·»åŠ ä»¥ä¸‹ä»£ç å—:

```
<template>
  <v-container>
    <v-card width="500" max-width="600">
      <v-toolbar color="pink" dark>
        <v-toolbar-title>Packages</v-toolbar-title>
        <v-spacer></v-spacer>
      </v-toolbar>
      <v-list two-line>
        <v-list-item-group active-class="pink--text">
          <div v-if="packages && packages.length > 0">
            <template v-for="tourPackage in packages">
              <v-list-item :key="tourPackage.id">
           <!-- <template> for <v-list-item-content> 
           here -->
              </v-list-item>
            </template>
            <v-divider />
          </div>
          <div v-else>
            <v-list-item>
              <v-list-item-content>
                <v-list-item-title
                  v-text="'No package added yet ğŸ˜¢'"
                ></v-list-item-title>
              </v-list-item-content>
            </v-list-item>
          </div>
        </v-list-item-group>
      </v-list>
    </v-card>
  </v-container>
</template>
```

å‰é¢çš„ä»£ç æ˜¯æ¥è‡ª Vuetify çš„å¡ç‰‡ç»„ä»¶ï¼Œç”¨äºå‘ˆç°æ‰€é€‰åŸå¸‚çš„æ¯ä¸ªåŒ…ã€‚ `card`ç»„ä»¶çš„å¤–è§‚å’Œæ„Ÿè§‰å°†ç±»ä¼¼äºæ—…æ¸¸åˆ—è¡¨ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯é¢œè‰²ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ `card`ç»„ä»¶çš„åˆ—è¡¨é¡¹å†…å®¹ã€‚ ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢æ³¨é‡Š`<!-- <template> for <v-list-item-content> here -->`:

```
<template>
  <v-list-item-content>
    <v-list-item-title v-text="tourPackage.name"></v-list-
    item-title>
    <v-list-item-subtitle
      class="text--primary"
      v-text="tourPackage.whatToExpect"
    ></v-list-item-subtitle>
    <div style="margin-top: 0.5rem; display: flex; flex-
    direction: row">
      <v-list-item-subtitle
        class="text--secondary"
        v-text="`Duration: ${tourPackage.duration}hrs`"
      ></v-list-item-subtitle>
      <v-list-item-subtitle
        class="text--secondary" v-text="
          `${tourPackage.instantConfirmation ? 'Instant 
           Confirmation' : ''}`"
      ></v-list-item-subtitle>
    </div>
  </v-list-item-content>
  <v-list-item-action>
    <v-icon> mdi-delete-outline </v-icon>
  </v-list-item-action>
</template>
```

å‰é¢çš„ä»£ç æ˜¯æ¯ä¸ªåŒ…æ‰€åœ¨è¡Œçš„ UIã€‚ å…¶ä¸­è¡Œä¸ºæ—…æ¸¸å¥—é¤çš„å±æ€§å€¼ï¼Œå¦‚`name`ã€`whatToExpect`ã€`duration`ã€`instantConfirmation`ã€‚

ç°åœ¨å†æ¬¡ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`DefaultContent.vue`ç»„ä»¶:

```
import TourPackagesCard from "@/components/TourPackagesCard";
```

æˆ‘ä»¬æ­£åœ¨å¯¼å…¥`TourPackagesCard`ç»„ä»¶ã€‚

è®©æˆ‘ä»¬åƒè¿™æ ·åœ¨`components`å—ä¸­æ³¨å†Œ`TourPackagesCard`ç»„ä»¶:

```
  components: { TourListsCard, AddTourListForm,
    TourPackagesCard, },
```

ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨`TourPackagesCard`ç»„ä»¶ã€‚

ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢`v-if="showPackages"`å’Œå ä½ç¬¦æ¶ˆæ¯:

```
 <div v-if="showPackages">
   <TourPackagesCard />
 </div>
```

ç°åœ¨ï¼Œåœ¨å•å‡»åŸå¸‚ä¹‹åï¼Œæˆ‘ä»¬çš„`TourPackagesCard`ç»„ä»¶åº”è¯¥æ˜¯å¯è§çš„ã€‚

è¿è¡Œ`dotnet run`å‘½ä»¤é‡æ–°å¯åŠ¨æ•´ä¸ªåº”ç”¨ã€‚

ç„¶åç‚¹å‡»**Oslo**ï¼Œä¼šæ˜¾ç¤º`TourPackagesCard`ç»„ä»¶ï¼Œé‡Œé¢æœ‰ä¸€äº›åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![Figure 15.6 â€“ TourPackagesCard component ](image/Figure_15.6_B15970.jpg)

å›¾ 15.6 - TourPackagesCard ç»„ä»¶

å›¾ 15.6 æ˜¾ç¤ºçš„`TourPackagesCard`ç»„ä»¶åœ¨å³ä¾§ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†åº”ç”¨ä¸­å”¯ä¸€çš„éå¼‚æ­¥æ“ä½œï¼Œè®©æˆ‘ä»¬å›åˆ°åœ¨ Vuex ä¸­ç¼–å†™å¼‚æ­¥æ“ä½œã€‚

# ä½¿ç”¨ Axios å’Œ Vuex ç§»é™¤æ—…è¡Œå›¢

åœ¨è¿™ä¸ªèŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°åœ¨åå°ä¸­åˆ é™¤æ—…è¡ŒåŒ…å’Œåœ¨ UI ä¸­åˆ é™¤æ—…è¡ŒåŒ…çš„åŠŸèƒ½ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`services.js`:

```
export async function deleteTourPackageAxios(id) {
  return await api.delete("TourPackages/" + id);
}
```

æˆ‘ä»¬æ­£åœ¨æ·»åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œåˆ é™¤ä¸€ä¸ªæ—…è¡Œå›¢ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`types.js`:

```
export const REMOVE_TOUR_PACKAGE = "REMOVE_TOUR_PACKAGE";
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„æ“ä½œç±»å‹æ¥åˆ é™¤æ—…è¡ŒåŒ…ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`actions.js`:

```
import { getTourListsAxios, deleteTourListAxios,
  postTourListAxios, deleteTourPackageAxios,
} from "@/store/tour/services";
```

æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä»£ç ä¸­å¯¼å…¥`deleteTourPackageAxios`ã€‚

è®©æˆ‘ä»¬åœ¨`actions.js`ä¸­æ·»åŠ å¦ä¸€ä¸ªåŠ¨ä½œ:

```
export async function removeTourPackageAction({ commit }, payload) {
  commit(types.LOADING_TOUR, true);
  try {
    await deleteTourPackageAxios(payload);
    commit(types.REMOVE_TOUR_PACKAGE, payload);
  } catch (e) {
    alert(e);
    console.log(e);
  }
  commit(types.LOADING_TOUR, false);
}
```

`removeTourPackageAction`å‡½æ•°ä½¿åŠ è½½å™¨æ—‹è½¬ï¼Œä½¿ç”¨ Axios å‘åç«¯å‘é€ä¸€ä¸ª*DELETE*è¯·æ±‚ï¼Œæäº¤ä¸€ä¸ªç±»å‹æ¥æŒ‡ç¤ºçªå˜åˆ é™¤ UI tour åŒ…ï¼Œç„¶åç¦æ­¢åŠ è½½å™¨åœæ­¢æ—‹è½¬ã€‚

ç„¶åï¼Œæ›´æ–°`store/tour`æ–‡ä»¶å¤¹ä¸­çš„`mutations.js`:

```
  [types.REMOVE_TOUR_PACKAGE](state, id) {
    state.packagesOfSelectedCity = 
    state.packagesOfSelectedCity.filter(
      (tp) => tp.id !== id);
  },
```

å‰é¢çš„çªå˜ä½¿ç”¨ JavaScript ä¸­å†…ç½®çš„è¿‡æ»¤å™¨åˆ é™¤ UI æ—…è¡ŒåŒ…ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è½¬åˆ°`TourPackagesCard.vue`ç»„ä»¶ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›´æ–°å®ƒ:

```
  methods: {
    ...mapActions("tourModule", ["removeTourPackageAction"]),
    removeTourPackage(packageId) {
      const confirmed = confirm(
        "You sure you want to permanently delete this tour 
        package?");
      if (!confirmed) return;
      // might need to wait for 1 min because of the cache
      this.removeTourPackageAction(packageId);
    },
  },
```

æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª`methods`å—å¹¶ä½¿ç”¨`mapActions`æ˜ å°„`removeTourPackageAction`ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†åˆ›å»ºå¦ä¸€ä¸ªåä¸º`removeTourPackage`çš„æ–¹æ³•ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ªç¡®è®¤å¯¹è¯æ¡†å’Œ`removeTourPackageAction`ã€‚

æœ€åï¼Œæ›´æ–°`v-icon`ç»„ä»¶ï¼Œç»™å®ƒä¸€ä¸ªä»¥`tourPackage.id`ä½œä¸ºå‚æ•°è¿è¡Œ`removeTourPackage`å‡½æ•°çš„ç‚¹å‡»äº‹ä»¶:

```
<v-icon @click="removeTourPackage(tourPackage.id)">
    mdi-delete-outline
</v-icon>
```

`v-icon`ç»„ä»¶å¯ä»¥ä½¿ç”¨äº†ã€‚ æˆ‘ä»¬å¯ä»¥ç‚¹å‡»åˆ é™¤ä¸€ä¸ªæ—…è¡Œå›¢ã€‚ è¿›å…¥ Vue appï¼Œç‚¹å‡»**City**ã€‚ ç‚¹å‡»åŸå¸‚åï¼Œåˆ é™¤ä»»ä½•æ—…æ¸¸å¥—é¤ã€‚ æ‚¨åº”è¯¥çœ‹åˆ°æ—…è¡Œå›¢å·²ä» UI ä¸­åˆ é™¤ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªéƒ¨åˆ†ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥æ·»åŠ æ–°æ—…è¡Œå›¢çš„åŠŸèƒ½ã€‚

# æ·»åŠ  Axios å’Œ Vuex å¥—é¤

è¿™ä¸ªéƒ¨åˆ†å°†æ„å»ºä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨ Axios å’Œ Vuex å°†ä¸€ä¸ªæ–°çš„æ—…æ¸¸å¥—é¤æ·»åŠ åˆ°ç°æœ‰çš„æ—…æ¸¸åˆ—è¡¨ä¸­ã€‚

è®©æˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`services.js`:

```
export async function postTourPackageAxios(tourPackage) {
  return await api.post("TourPackages", tourPackage);
}
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåœ¨åç«¯åˆ›å»ºæ–°çš„`tourPackage`çš„æ–°æœåŠ¡ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`types.js`:

```
export const ADD_TOUR_PACKAGE = "ADD_TOUR_PACKAGE";
```

ä»£ç æ›´æ–°æ·»åŠ äº†ç”¨äºæ·»åŠ æ—…è¡ŒåŒ…çš„æ–°æ“ä½œç±»å‹ã€‚

ç°åœ¨ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`store/tour`ä¸­çš„`actions.js`:

```
import { getTourListsAxios, deleteTourListAxios,
  postTourListAxios, deleteTourPackageAxios,
  postTourPackageAxios,
} from "@/store/tour/services";
```

æˆ‘ä»¬é¦–å…ˆå¯¼å…¥æœåŠ¡`postTourPackageAxios`ï¼Œæ­£å¦‚æ‚¨åœ¨å‰é¢çš„ä»£ç ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸­ä½¿ç”¨å¯¼å…¥`postTourPackageAxios`ï¼Œä»£ç å¦‚ä¸‹:

```
export async function addTourPackageAction({ commit }, payload) {
  commit(types.LOADING_TOUR, true);
  try {
    const { data } = await postTourPackageAxios(payload);
    payload.id = data; // storing the id from the response 
    int of ASP.NET Core, which will be used in the UI.
    commit(types.ADD_TOUR_PACKAGE, payload);
  } catch (e) {
    alert(e);
    console.log(e);
  }
  commit(types.LOADING_TOUR, false);
}
```

`addTourPackageAction`æ‰“å¼€åŠ è½½ç¨‹åºï¼Œå‘åç«¯å‘é€*POST*è¯·æ±‚ï¼Œé€šè¿‡è°ƒç”¨æäº¤å°†`tourPackage`æ·»åŠ åˆ° UI ä¸­ï¼Œç„¶åå…³é—­åŠ è½½ç¨‹åºã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`mutations.js`:

```
  [types.ADD_TOUR_PACKAGE](state, tourPackage) {
    state.packagesOfSelectedCity.unshift(tourPackage);
  },
```

ä¹‹å‰çš„ä»£ç æ˜¯ä¸€ä¸ªçªå˜ï¼Œå®ƒå°†æ–°çš„`tourPackage`æ·»åŠ åˆ°`packagesOfSelectedCity`æ•°ç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼•ã€‚

ç„¶åï¼Œå¯¹äºè¡¨å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ æ–°çš„`tourPackage`ï¼Œåœ¨ç»„ä»¶ä¸­åˆ›å»ºä¸€ä¸ª Vue ç»„ä»¶`AddTourPackageForm.vue`ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹è„šæœ¬:

```
<script>
import { mapActions } from "vuex";
export default {
  name: "AddTourPackageForm",
  props: {
    tourListId: { type: Number, },
  },
  data: () => ({
    id: 0,
    bodyRequest: {
      listId: 0, name: "", whatToExpect: "",
      mapLocation: "https://www.google.com/maps/place/...",
      price: 10, duration: 1, instantConfirmation: true,
    },
    dialog: false,
    currencies: ["USD", "NOK"],
    currencyValues: [0, 1],
    durations: [1, 2, 3, 4, 5, 6, 7, 8],
    durationValue: 1,
  }),
  methods: {
    ...mapActions("tourModule", ["addTourPackageAction"]),
    onSubmit() {
      this.bodyRequest.listId = this.tourListId;
      this.addTourPackageAction(this.bodyRequest); // 
      triggers the method of the container holding this
      this.bodyRequest = {};
    },
  },
};
</script>
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ‰`id`ã€`bodyRequest`ã€`dialog`ã€`currencies`ã€`currencyValues`ã€`durations`å’Œ`durationValue`å±€éƒ¨çŠ¶æ€ã€‚ æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­ä¹Ÿæœ‰`mapActions`ä¼ æ’­ï¼Œè§¦å‘`addTourPackageAction`æ–¹æ³•ä¸­æœ‰`onSubmit`ä¼ æ’­ã€‚ æœ€åï¼Œå½¢å¼æœ‰ä¸€ä¸ª`tourListId`é“å…·ï¼Œæ˜¯`tourList`ä¸­çš„`id`ã€‚

ä¸º UI æ·»åŠ ä»¥ä¸‹`template`è¯­æ³•:

```
<template>
  <v-row justify="center">
    <v-dialog v-model="dialog" persistent max-
    width="600px">
      <template v-slot:activator="{ on, attrs }">
        <v-btn
          style="margin-top: 1rem" rounded color="pink"
          dark v-bind="attrs" v-on="on">
          <v-icon left> mdi-plus </v-icon>
          add new tour package
        </v-btn>
      </template>
      <!-- Insert <v-card> here -->
    </v-dialog>
  </v-row>
</template>
```

æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰“å¼€å¯¹è¯æ¡†æˆ–æ¨¡æ€å½¢å¼çš„ç»„ä»¶ã€‚ æ­¤è¡¨æ ¼ç±»ä¼¼äºæ—…æ¸¸æ¸…å•ä¸­çš„è¡¨æ ¼ã€‚

ç°åœ¨ï¼Œç”¨ä¸‹é¢çš„æ¨¡æ¿è¯­æ³•æ›¿æ¢`< !-- Insert <v-card> here -->`:

```
  <v-card>
    <form @submit.prevent="onSubmit">
      <v-card-title>
        <span class="headline">Create New Tour 
        Package</span>
      </v-card-title>
      <v-card-text>
        <v-container>
          <v-row>
            <v-col cols="12">
              <v-text-field required label="Name"
                v-model="bodyRequest.name"
              ></v-text-field>
            </v-col>
            <!-- Removed for brevity -->
            <!-- Please see the full code in GitHub -->
          </v-row>
        </v-container>
        <small>*indicates required field</small>
      </v-card-text>
      <!-- Insert <v-card-actions> here -->
    </form>
  </v-card>
```

å‰é¢çš„è¡¨å•å…è®¸ç”¨æˆ·æ·»åŠ ä¸€ä¸ªæ–°çš„æ—…æ¸¸åŒ…ã€‚ è¡¨æ ¼ä¸­åŒ…å«æ—…æ¸¸å¥—é¤:`name`ã€`whatToExpect`ã€`mapLocation`ã€`price`ã€`duration`ã€`instant``confirmation`ã€‚

è®©æˆ‘ä»¬ä¹Ÿæ·»åŠ ä¸€äº›æŒ‰é’®:

```
  <v-card-actions>
    <v-spacer></v-spacer>
    <v-btn color="blue darken-1" text @click="dialog = 
    false"> Close </v-btn>
    <v-btn color="blue darken-1" text @click="dialog = 
    false" type="submit">
      Save
    </v-btn>
  </v-card-actions>
```

`Close v-btn`å’Œ`Save v-btn`éƒ½å…·æœ‰å…³é—­å¯¹è¯æ¡†çš„åŠŸèƒ½ï¼Œä½†`Save v-btn`æ˜¯`submit`ç±»å‹ï¼Œè¿™æ„å‘³ç€å®ƒè§¦å‘`for`çš„`@submit`ã€‚ ç„¶åä»`methods`å—ä¸­è§¦å‘`onSubmit`æ–¹æ³•ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¬¡æ›´æ–°`DefaultContent.vue`ç»„ä»¶:

```
import AddTourPackageForm from "@/components/AddTourPackageForm";
```

æˆ‘ä»¬æ­£åœ¨å¼•å…¥`AddTourPackageForm`ã€‚ ç„¶åè®©æˆ‘ä»¬åƒè¿™æ ·åœ¨`components`å—ä¸­æ³¨å†Œ`AddTourPackageForm`:

```
  components: { TourListsCard, AddTourListForm,
    TourPackagesCard, AddTourPackageForm, },
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æ’å…¥`AddTourPackageForm`åˆ°`template`è¯­æ³•éƒ¨åˆ†ã€‚

åœ¨`TourPackagesCard`ç»„ä»¶ä¸‹é¢æ’å…¥`AddTourPackageForm`ç»„ä»¶ã€‚ ä¸è¦å¿˜è®°åœ¨`tourListId`é“å…·ä¸­é€šè¿‡`tourListId`:

```
      <div v-if="showPackages">
        <TourPackagesCard />
        <AddTourPackageForm :tourListId="tourListId" />
      </div>
```

`AddTourPackageForm`ç°åœ¨åœ¨`template`è¯­æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨äº†ã€‚

å¦‚æœ ESLint é”™è¯¯é˜»æ­¢ Vue.js åº”ç”¨åˆ·æ–°ï¼Œé‡å¯æœåŠ¡å™¨ã€‚

å¥½çš„ï¼Œè®©æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œçœ‹åˆ°**ADD NEW TOUR PACKAGE**æŒ‰é’®ï¼Œå¦‚ä¸‹æˆªå›¾æ‰€ç¤º:

![Figure 15.7 â€“ ADD NEW TOUR PACKAGE button ](image/Figure_15.7_B15970.jpg)

å›¾ 15.7 - ADD NEW TOUR PACKAGE æŒ‰é’®

ç°åœ¨ï¼Œç‚¹å‡»æ–°å¢çš„æŒ‰é’®ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¼šå‡ºç°å¯¹è¯æ¡†è¡¨å•ï¼Œå¦‚ä¸‹æˆªå›¾æ‰€ç¤º:

![Figure 15.8 â€“ Create New Tour Package form ](image/Figure_15.8_B15970.jpg)

å›¾ 15.8 -åˆ›å»ºæ–°æ—…è¡Œå›¢è¡¨å•

*å›¾ 15.8*æ˜¾ç¤ºä¸ºåˆ›å»ºä¸€ä¸ªæ–°çš„æ—…æ¸¸åŒ…çš„è¡¨å•ã€‚ å°è¯•å¡«å†™è¡¨æ ¼ï¼Œç‚¹å‡»**ä¿å­˜**ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›å…¥ä¸‹ä¸€èŠ‚äº†ã€‚

# ä½¿ç”¨ Axios å’Œ Vuex æ›´æ–°æ—…æ¸¸å¥—é¤

æˆ‘ä»¬åœ¨æœ¬ç« çš„æœ€åä¸€èŠ‚ï¼Œè¿™ä¸€èŠ‚æ˜¯å…³äºä½¿ç”¨*PUT HTTP*è¯·æ±‚å’Œ Vuex æ›´æ–°ä¸€ä¸ªæ—…è¡Œå›¢ã€‚ æˆ‘ä»¬å°†åˆ›å»ºå¦ä¸€ä¸ªçª—ä½“æ¥ç¼–è¾‘æ—…è¡Œå›¢ã€‚ è®©æˆ‘ä»¬å¼€å§‹ã€‚

ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯æ›´æ–°ç›®å½•ä¸­çš„`store/tour``services.js`:

```
export async function putTourPackageAxios(tourList) {
  return await api.put(`TourPackages/${tourList.id}`, 
  tourList);
}
```

æˆ‘ä»¬æ­£åœ¨æ·»åŠ ä¸€ä¸ªæ–°æœåŠ¡ï¼Œå®ƒå‘åç«¯æœåŠ¡å™¨å‘é€ä¸€ä¸ª*PUT*è¯·æ±‚ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¬¡æ›´æ–°`store/tour`æ–‡ä»¶å¤¹çš„`types.js`:

```
export const UPDATE_TOUR_PACKAGE = "UPDATE_TOUR_PACKAGE";
```

å‰é¢çš„ä»£ç æ˜¯ç”¨äºæ›´æ–°æ—…è¡Œå›¢çš„æ–°æ“ä½œç±»å‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ›´æ–°äº†`store/tour`æ–‡ä»¶å¤¹ä¸­çš„`actions.js`:

```
import { getTourListsAxios, deleteTourListAxios,
  postTourListAxios, deleteTourPackageAxios,
  postTourPackageAxios, putTourPackageAxios,
} from "@/store/tour/services";
```

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å¯¼å…¥`putTourPackageAxios`æœåŠ¡ã€‚

ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªæ–°çš„å¼‚æ­¥ Vuex æ“ä½œã€‚ è¯¥æ“ä½œå°†æ˜¯åœ¨`actions.js`æ–‡ä»¶ä¸­çš„æœ€åä¸€ä¸ª Vuex æ“ä½œ:

```
export async function updateTourPackageAction({ commit }, payload) {
  commit(types.LOADING_TOUR, true);
  try {
    await putTourPackageAxios(payload);
    commit(types.UPDATE_TOUR_PACKAGE, payload);
  } catch (e) {
    alert(e);
    console.log(e);
  }
  commit(types.LOADING_TOUR, false);
}
```

æ–°æ·»åŠ çš„æ“ä½œç§°ä¸º`updateTourPackageAction`ä½¿è£…è½½æœº,å‘é€ä¸€ä¸ª*æŠŠè¯·æ±‚çš„æœ‰æ•ˆè½½è·åå°,`UPDATE_TOUR_PACKAGE`å’Œæäº¤,é€šè¿‡ th eã€æ˜¾ç¤ºã€‘æœ‰æ•ˆè½½è·ä¹Ÿæ›´æ–° UI,ç„¶åç¦ç”¨çš„åŠ è½½ UIã€‚*

ç„¶åæˆ‘ä»¬ä¹Ÿç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`store/tour`ä¸­çš„`mutations.js`:

```
  [types.UPDATE_TOUR_PACKAGE](state, payload) {
    const packageIndex = 
    state.packagesOfSelectedCity.findIndex(
      (pl) => pl.id === payload.id);
    state.packagesOfSelectedCity[packageIndex] = payload;
    const listIndex = state.lists.findIndex(
      (l) => l.id === state.packagesOfSelectedCity.listId);
    state.lists[listIndex] = state.packagesOfSelectedCity;
  },
```

æˆ‘ä»¬æ­£åœ¨æ·»åŠ ä¸€ä¸ªæ–°çš„çªå˜ï¼Œå®ƒå¯ä»¥æ‰¾åˆ°ç‰¹å®šæ—…è¡Œå›¢çš„ç´¢å¼•ã€‚ æ‰¾åˆ°ç´¢å¼•åï¼Œæˆ‘ä»¬é€šè¿‡ç´¢å¼•å®šä½ç‰¹å®šçš„æ—…è¡Œå›¢ï¼Œç„¶åç”¨æœ‰æ•ˆè½½è·(æ›´æ–°åçš„æ—…è¡Œå›¢)å¯¹å…¶è¿›è¡Œçªå˜ã€‚

æˆ‘ä»¬ä¹Ÿé€šè¿‡å†æ¬¡æ‰¾åˆ°`selectedCity`çš„ç´¢å¼•ï¼Œç„¶åç¼–è¾‘å®ƒæ¥æ›´æ–°`tourList`ã€‚ ä¸Šè¿°é€»è¾‘ä½¿æ‰€æœ‰å—å½±å“çš„å¯¹è±¡å’Œæ•°ç»„ä¿æŒåŒæ­¥ã€‚

ç°åœ¨ï¼Œåœ¨`components`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`UpdateTourPackageForm.vue`çš„Vue ç»„ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹è„šæœ¬æ·»åŠ åˆ°æ–°çš„Vue ç»„ä»¶:

```
<script>
import { mapActions } from "vuex";
export default {
  name: "UpdateTourPackageForm",
  props: {
    bodyRequest: {
      type: Object,
      required: true,
      default: { listId: 0, name: "missing name",
        whatToExpect: "missing what to expect",
        mapLocation: "missing map location",
        price: 0, duration: 0, instantConfirmation: true,
      },
    },
  },
  methods: {
    ...mapActions("tourModule", 
    ["updateTourPackageAction"]),
    onSubmit() {
      this.updateTourPackageAction(this.bodyRequest); // 
      fyi, you might not see the results right away because 
      of the cache.
    },
  },
  data: () => ({
    dialog: false,
    currencies: ["USD", "NOK"],
    currencyValues: [0, 1],
    durations: [1, 2, 3, 4, 5, 6, 7, 8],
    durationValue: 1,
  }),
};
</script>
```

çš„å‰è„šæœ¬æä¾›äº†ä¸€ä¸ª`bodyRequest`é“å…·,ä½¿ç”¨`mapActions`,`onSubmit`æ–¹æ³•,è°ƒç”¨`updateTourPackageAction`,ã€ç—…äººã€‘ä¸€ç»„å½“åœ°å·â€”â€”å³`dialog`ã€`currencies`,`currencyValues`,`durations`ã€ã€æ˜¾ç¤ºã€‘ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ·»åŠ `template`è¯­æ³•:

```
<template>
  <v-row justify="center">
    <v-dialog v-model="dialog" persistent max-
    width="600px">
      <template v-slot:activator="{ on, attrs }">
        <v-icon class="mr-3" v-bind="attrs" v-on="on">
          mdi-clipboard-edit-outline
        </v-icon>
      </template>
      <v-card>
        <form @submit.prevent="onSubmit">
          <v-card-title>
            <span class="headline">Update Tour 
            Package</span>
          </v-card-title>
          <v-card-text>
            <!-- Insert <v-container> Here -->
            <small>*indicates required field</small>
          </v-card-text>
          <v-card-actions>
            <v-spacer></v-spacer>
            <v-btn text color="blue darken-1" 
            @click="dialog = false">
              Close
            </v-btn>
            <v-btn text color="blue darken-1" 
              @click="dialog = false" type="submit">
              Update
            </v-btn>
          </v-card-actions>
        </form>
      </v-card>
    </v-dialog>
  </v-row>
</template>
```

å‰é¢çš„æ¨¡æ¿è¯­æ³•å—æ˜¯`UpdateTourPackageForm.vue`çš„ UIã€‚ è¯¥æ¨¡æ¿ä½¿ç”¨äº†`v-card`ç»„ä»¶ï¼Œå®ƒçœ‹èµ·æ¥å¾ˆæ•´æ´ï¼Œå¹¶ä¸”é‡‡ç”¨å…·æœ‰`@submit`æŒ‡ä»¤äº‹ä»¶æ¥è°ƒç”¨æˆ–è§¦å‘`onSubmit`å‡½æ•°çš„å½¢å¼ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨æ›¿æ¢`<!â€”Insert <v-container> Here -->`ä»¥ä¸‹æ¨¡æ¿è¯­æ³•:

```
<v-container>
    <v-row>
      <v-col cols="12">
        <v-text-field required label="Name"
          v-model="bodyRequest.name"
        ></v-text-field>
      </v-col>
      <v-col cols="12">
        <v-textarea
          label="What to expect"
          v-model="bodyRequest.whatToExpect" required
        ></v-textarea>
      </v-col>
      <!-- Removed for brevity -->
      <!-- Please see the full code in GitHub -->
      </v-col>
    </v-row>
  </v-container>
```

å‰é¢çš„æ¨¡æ¿è´Ÿè´£æä¾›è¡¨å•ä¸­æ‰€éœ€çš„å­—æ®µã€‚ æ—…æ¸¸å¥—é¤å­—æ®µå¦‚ä¸‹:`name`ã€`whatToExpect`ã€`mapLocation`ã€`price`ã€`duration`ã€`instantConfirmation`ã€‚ æ‚¨å°†æ³¨æ„åˆ°å­—æ®µæ­£åœ¨ä½¿ç”¨`bodyRequest`é“å…·ï¼Œå› ä¸ºè¿™äº›é“å…·å°†æ˜¯ç”¨æˆ·å°†è¦ç¼–è¾‘çš„`tourPackage`ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°`TourPackagesCard.vue`:

```
import UpdateTourPackageForm from "@/components/UpdateTourPackageForm";
```

æˆ‘ä»¬æ­£å°†`UpdateTourPackageForm`å¯¼å…¥`TourPackagesCard.vue`ã€‚ ç„¶åæˆ‘ä»¬å°†`UpdateTourPackageForm`æ³¨å†Œåˆ°`components`å—ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
  components: { UpdateTourPackageForm },
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿è¯­æ³•åŒºåŸŸä¸­ä½¿ç”¨`UpdateTourPackageForm`ã€‚

ä½¿ç”¨ä»¥ä¸‹æ–°ä»£ç æ›´æ–°`template`éƒ¨åˆ†ä¸­çš„`<v-list-item-action>`ç»„ä»¶:

```
  <v-list-item-action>
    <UpdateTourPackageForm :bodyRequest="tourPackage" />
    <v-icon @click="removeTourPackage(tourPackage.id)">
      mdi-delete-outline
    </v-icon>
  </v-list-item-action>
```

å‰é¢çš„æ¨¡æ¿ä»£ç å—åŒ…å«ç”¨äºæ›´æ–°æ—…è¡Œå›¢çš„ UIã€‚

ç°åœ¨ï¼Œåœ¨æµ‹è¯•æ–°è¡¨å•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹ ASP.NET Core Web APIã€‚ è½¬åˆ°`Travel.Application.TourPackages.Commands.UpdateTourPackage`å‘½åç©ºé—´çš„`UpdateTourPackageCommandValidator.cs`ã€‚ ç„¶åï¼Œåƒè¿™æ ·ç¼–è¾‘`Name`çš„æœ€å¤§é•¿åº¦è§„åˆ™:

```
public UpdateTourPackageCommandValidator(IApplicationDbContext context)
    {
      _context = context;
      RuleFor(v => v.Name)
        .NotEmpty().WithMessage("Name is required.")
        .MaximumLength(200).WithMessage("Name must not 
        exceed 200 characters.");
    }
```

åç§°åº”è¯¥ä»…ä¸º`200`å­—ç¬¦ã€‚ ç„¶è€Œï¼Œè¿™ä¸ªè¿˜ä¸å¤Ÿã€‚ æˆ‘ä»¬è¿˜å°†åœ¨å‰ç«¯åˆ›å»ºä¸€ä¸ªéªŒè¯ï¼Œä½†è¿™å°†åœ¨[*ç¬¬ 17 ç« *](17.html#_idTextAnchor333)ï¼Œ*Input validation in Forms*ä¸­ä»‹ç»ã€‚

ç°åœ¨é‡æ–°è¿è¡Œåº”ç”¨ï¼Œçœ‹çœ‹åº”ç”¨æ˜¯å¦ä»ç„¶è¿è¡Œæ²¡æœ‰ä»»ä½•é—®é¢˜:

![Figure 15.9 â€“ Pencil pad icon ](image/Figure_15.9_B15970.jpg)

å›¾ 15.9 -é“…ç¬”æ¿å›¾æ ‡

*å›¾ 15.9*æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªæ—…æ¸¸å¥—é¤ã€‚ å°è¯•é€šè¿‡å•å‡»é“…ç¬”æ¿å›¾æ ‡æ¥æ›´æ–°æ—…è¡Œå›¢ï¼Œè¯¥å›¾æ ‡å°†æ‰“å¼€`UpdateTourPackageForm`ç»„ä»¶ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ‚¨åœ¨è¿™ä¸€é•¿ç« ä¸­å­¦åˆ°çš„å…³äº HTTP è¯·æ±‚ã€Vuex çŠ¶æ€ç®¡ç†å’Œæ¥è‡ª Vuetify çš„è¡¨å•çš„å†…å®¹ã€‚

# æ€»ç»“

ä½ å·²ç»å®Œæˆäº†ã€‚ å¹²å¾—å¥½! ç°åœ¨è®©æˆ‘ä»¬æŠŠä½ ä»è¿™ä¸€ç« ä¸­å­¦åˆ°çš„ä¸œè¥¿åˆ†è§£å¼€æ¥ã€‚ æ‚¨å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Axios (HTTP å®¢æˆ·ç«¯åº“)è¿›è¡Œ CRUDã€‚ æ‚¨å·²ç»å­¦ä¹ äº†å¦‚ä½•åœ¨ Vuex ä¸­ç¼–å†™å¼‚æ­¥å’Œéå¼‚æ­¥æ“ä½œã€‚ æ‚¨è¿˜å­¦ä¹ äº†å¦‚ä½•åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`mapActions`å’Œ`mapGetters`ã€‚ æœ€åï¼Œæ‚¨å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Vuetify æ¥æ„å»ºæœ‰å¸å¼•åŠ›çš„è¡¨å•å’ŒæŒ‰é’®ã€‚

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºç”¨æˆ·æ„å»ºç™»å½•å’Œæ³¨å†Œè¡¨å•ã€‚ æˆ‘ä»¬è¿˜å°†åœ¨åç«¯å¯ç”¨æˆæƒï¼Œä»¥ä¾¿åªæœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰èƒ½å‘æˆ‘ä»¬çš„ ASP å‘é€ CRUD æ“ä½œ.NET Core Web APIã€‚